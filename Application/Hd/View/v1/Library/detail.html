<layout name="layout" />
<style type="text/css">
    body{ background-image:url(__HD__/images/library/bg.png); }

    #div_top{
        position:absolute;
        width:282px;
        height:57px;
        top:60px;
        left:100px;
        visibility:visible;
        background-image: url(__HD__/images/library/ketang_bg.png);      
    }    
    
    .title{
        position: absolute;
        top:190px;
        left:170px;
        width: 950px;
        height: 100px;
        color:#00648c;
        font-size: 20px;
        line-height: 35px;
        font-weight: 590;
    }
    
    /*弹窗背景*/
	#transparent_bg{
         position:absolute;
         width:1280px;
         height:720px;
         top:0px;
         left:0px;
         visibility:hidden;
    	 z-index:999;
         background-image: url(__HD__/images/common/popup/bg.png);            	
    }    
    
    /*退出弹框*/
    #pop_exit_bg{
        position:absolute;
        display: block;
        width:561px;
        height:365px;
        top:177px;
        left:314px; 
        background-image:url(__HD__/images/library/exit_bg.png);
        z-index: 1000;    
    }
    
    /*完成题目弹窗*/
    .pop_bg{
        position:absolute;
        display: block;
        width:651px;
        height:424px;
        top:148px;
        left:314px;
        background-image:url(__HD__/images/library/pop_bg.png);
        z-index: 1000;
    }
    /*获取多少分*/
    .countscore{
        position:absolute;
        display: block;
        width:100px;
        height:40px;
        line-height: 40px;
        top:225px;
        left:720px;
        color:#f65074;
        text-align: center;
        font-weight: 700;
        font-size: 34px;
        z-index: 1000;
    }

    /*答对多少题*/
    .correctnum{
        position:absolute;
        display: block;
        width:50px;
        height:20px;
        line-height: 20px;
        top:320px;
        left:485px;
        color:#f65074;
        text-align: center;
        font-weight: 600;
        font-size: 22px;
        z-index: 1000;
    }
    /*答错多少题*/
    .wrongnum{
        position:absolute;
        display: block;
        width:50px;
        height:20px;
        line-height: 20px;
        top:320px;
        left:635px;
        color:#f65074;
        text-align: center;
        font-weight: 600;
        font-size: 22px;
        z-index: 1000;
    }
    /*多少小红花*/
    .rednum{
        position:absolute;
        display: block;
        width:50px;
        height:20px;
        line-height: 20px;
        top:320px;
        left:805px;
        color:#f65074;
        text-align: center;
        font-weight: 600;
        font-size: 22px;
        z-index: 1000;
    }
</style>

<script type="text/javascript">

    var buttons =
            [
                /*文字答题选项*/
                {id: 'answer_1', name: '', action: 'answer(1)', linkImage: '__HD__/images/library/word_1.png', focusImage: '__HD__/images/library/word_1_over.png', selectBox: '', left: '', right: 'answer_2', up: 'btn_ketang', down:['answer_3','next','exit']},
                {id: 'answer_2', name: '', action: 'answer(2)', linkImage: '__HD__/images/library/word_2.png', focusImage: '__HD__/images/library/word_2_over.png', selectBox: '', left: 'answer_1', right: '', up: 'btn_ketang', down:['answer_4','next','exit']},
                {id: 'answer_3', name: '', action: 'answer(3)', linkImage: '__HD__/images/library/word_3.png', focusImage: '__HD__/images/library/word_3_over.png', selectBox: '', left: '', right: 'answer_4', up: 'answer_1', down:['next','exit']},
                {id: 'answer_4', name: '', action: 'answer(4)', linkImage: '__HD__/images/library/word_4.png', focusImage: '__HD__/images/library/word_4_over.png', selectBox: '', left: 'answer_3', right: '', up: 'answer_2', down: ['next','exit']},
                /*答题选项*/
                {id: 'answer2_1', name: '', action: 'answer(1)', linkImage: '', focusImage: '', selectBox: '__HD__/images/library/pic_item_bg_over.png', resize:'-1', left: '', right: 'answer2_2', up: '', down: 'next'},
                {id: 'answer2_2', name: '', action: 'answer(2)', linkImage: '', focusImage: '', selectBox: '__HD__/images/library/pic_item_bg_over.png', resize:'-1', left: 'answer2_1', right: ['answer2_3', 'next'], up: '', down: 'next'},
                {id: 'answer2_3', name: '', action: 'answer(3)', linkImage: '', focusImage: '', selectBox: '__HD__/images/library/pic_item_bg_over.png', resize:'-1', left: 'answer2_2', right: ['answer2_4', 'next'], up: '', down: 'exit'},
                {id: 'answer2_4', name: '', action: 'answer(4)', linkImage: '', focusImage: '', selectBox: '__HD__/images/library/pic_item_bg_over.png', resize:'-1', left: 'answer2_3', right: 'next', up: '', down: 'exit'},
                /* 下一题 */
                {id: 'next', name: '', action: 'nextAnswer()', linkImage: '__HD__/images/library/next.png', focusImage: '__HD__/images/library/next_over.png', selectBox: '', left: '', right: 'exit', up: '', down: ''},
                /*返回*/
                {id: 'exit', name: '', action: 'showExit()', linkImage: '__HD__/images/library/exit.png', focusImage: '__HD__/images/library/exit_over.png', selectBox: '', right: '', left: 'next', up: '', down: ''},
                /*重新答题*/
                {id: 're_answer', name: '', action: 'reanswer()', linkImage: '__HD__/images/library/re_answer.png', focusImage: '__HD__/images/library/re_answer_over.png', selectBox: '', right: 'back_learn', left: '', up: '', down: ''},
                /*返回学习*/
                {id: 'back_learn', name: '', action: 'backlearn()', linkImage: '__HD__/images/library/back_learn.png', focusImage: '__HD__/images/library/back_learn_over.png', selectBox: '', right: '', left: 're_answer', up: '', down: ''},
                /*是的*/
                {id: 'yes', name: '', action: 'exitPrePage()', linkImage: '__HD__/images/library/yes.png', focusImage: '__HD__/images/library/yes_over.png', selectBox: '', right: 'no', left: '', up: '', down: ''},
                /*不*/
                {id: 'no', name: '', action: 'disExit()', linkImage: '__HD__/images/library/no.png', focusImage: '__HD__/images/library/no_over.png', selectBox: '', right: '', left: 'yes', up: '', down: ''},
                /*同步课堂*/
                {id: 'btn_ketang', name: '', action: 'exitPrePage()', linkImage: '__HD__/images/library/btn_ketang.png', focusImage: '__HD__/images/library/btn_ketang_over.png', selectBox: '', left: '', right: '', up: '', down: ['answer_1','answer2_1']},
            	
            ];

    var postdata = [];
    var roleid = {$roleId}; //知识点ID
    var topicid = {$topicId}; //知识点ID
    var sectionid = {$sectionId}; //课时ID
    var answerlist = {$answerList};
    var countlib = answerlist.length;
    var itemid; //题目ID
    var countscore = 0;//获取总分数
    var kind; //该题类型
    var score;//当前这道题的分数
    var correct;//定义当前这道题的正确答案
    var wrong;//定义用户选择的错误答案
    var theAnswer; //第几道题目
    var initButton; //题目类型
    var html;//显示的HTML
    var correctnum = 0;
    var wrongnum = 0;
    var rednum = 0;
    var status;

    function answer(i) {
        var data = {};
        
        if (i == correct) {
            wrong = 0;
            correct = i;
            correctnum += 1;
            countscore += score;
            status = true;
            if (kind == 'word') {
                G('div_error_' + i).style.display = "none";
                G('div_correct_' + i).style.display = "block";
            } else {
                G('div_error2_' + i).style.display = "none";
                G('div_correct2_' + i).style.display = "block";
            }

        } else {
            wrong = i;
            wrongnum += 1;
            status = false;
            if (kind == 'word') {
                G('div_correct_' + i).style.display = "none";
                G('div_error_' + i).style.display = "block";
            } else {
                G('div_correct2_' + i).style.display = "none";
                G('div_error2_' + i).style.display = "block";
            }
        }
        data = {'roleId': roleid, 'topicId': topicid, 'sectionId': sectionid, 'itemId': itemid, 'correct': correct, 'wrong': wrong, 'status': status};
        postdata.push(data);
        setTimeout("nextAnswer()", 1500);
    }
    //item是第几道题目
    function initAnswer(item) {
        theAnswer = item;
        G('now_page').innerHTML = theAnswer+'&nbsp;/&nbsp;'+countlib;
        html = '';
        var n = item - 1;

        //初始化标题
        G('title').innerHTML = answerlist[n]['title'];
        //初始化该道题答案
        correct = answerlist[n]['correct'];
        //初始化该题的分数
        score = answerlist[n]['score'];
        //初始化题目ID
        itemid = answerlist[n]['id'];

        var itemlist = answerlist[n]['itemList'];
        //该题是文字类型还是图片类型
        kind = answerlist[n]['kind'];
        if (kind == 'word') {
            //显示文字
            G('word').style.display = "block";
            G('pic').style.display = "none";
            //修改上下页和返回键的up值
            buttons[7]['up'] = ['answer_4', 'answer_2'];
            buttons[8]['up'] = ['answer_4', 'answer_2'];
            buttons[9]['up'] = ['answer_4', 'answer_2'];
            //初始化按钮
            initButton = 'answer_1';
            //alert(itemlist.length);
            //初始化各选项
            for (var i = 0; i < itemlist.length; i++) {
                var top = parseInt(400 + Math.floor(i/2) * 90);
                var left = parseInt(150 + (i%2) * 520);
                var num = i + 1;
                html += '<div id="div_answer_' + num + '" title="" style="position:absolute;width:452px;height:77px;left:'+left+'px;top:' + top + 'px;text-align:center;">';
                html += '<img id="answer_' + num + '" src="__HD__/images/library/word_' + num + '.png" width="452" height="77">';
                html += '</div>';
                html += '<div id="div_answer_' + num + '_focus" title="" style="position:absolute;width:360px;height:60px;left:'+parseInt(left+70)+'px;top:' + parseInt(top+10) + 'px;z-index:888">';
                html += '<span id="answer_' + num + '_focus" style="display: block;height:50px;line-height: 60px;color:#000;color:#ffffff;font-size:25px;font-weight: 590;">' + itemlist[i] + '</span>';
                html += '</div>';
                html += '<div id="div_correct_' + num + '" style="display:none;position:absolute;width:55px;height:53px;left:'+parseInt(left+415)+'px;top:' + parseInt(top + 12) + 'px;z-index:800">';
                html += '<img id="correct_' + num + '" src="__HD__/images/library/success_1.png" width="55" height="53" />';
                html += '</div>';
                html += '<div id="div_error_' + num + '" style="display:none;position:absolute;width:55px;height:53px;left:'+parseInt(left+415)+'px;top:' + parseInt(top + 12) + 'px;z-index:888">';
                html += '<img id="error_' + num + '" src="__HD__/images/library/error_1.png"  width="55" height="53" />';
                html += '</div>';
            }

            G('word').innerHTML = html;
        } else {
            //显示图片

            G('pic').style.display = "block";
            G('word').style.display = "none";
            buttons[7]['up'] = 'answer2_1';
            buttons[8]['up'] = ['answer2_2', 'answer2_1'];
            buttons[9]['up'] = ['answer2_3', 'answer2_2', 'answer2_1'];
            //初始化按钮
            initButton = 'answer2_1';
            //初始化各选项
            for (var j = 0; j < itemlist.length; j++) {
                var left = parseInt(120 + j * 300);
                var num2 = j + 1;
                html += '<div id="div_answer2_' + num2 + '" title="" style="position:absolute;width:270px;height:283px;left:' + left + 'px;top:270px;text-align:center;z-index:999">';
                html += '<img id="answer2_' + num2 + '" src="' + itemlist[j] + '" width="270" height="283" />';
                html += '</div>';
                html += '<div id="div_answer2_' + num2 + '_focus" title="" style="position:absolute;width:270px;height:283px;left:' + left + 'px;top:270px;z-index:999">';
                html += '<img id="answer2_' + num2 + '_focus" src="__HD__/images/library/pic_item_bg.png" />';
                html += '</div>';
                html += '<div id="div_correct2_' + num2 + '" style="display:none;position:absolute;width:120px;height:109px;left:' + parseInt(left + 180) + 'px;top:450px;z-index:999">';
                html += '<img id="correct2_' + num2 + '" src="__HD__/images/library/success_2.png" width="120" height="109" />';
                html += '</div>';
                html += '<div id="div_error2_' + num2 + '" style="display:none;position:absolute;width:120px;height:109px;left:' + parseInt(left + 180) + 'px;top:450px;z-index:999">';
                html += '<img id="error2_' + num2 + '" src="__HD__/images/library/error_2.png"  width="120" height="109" />';
                html += '</div>';
            }
            //alert(html);
            G('pic').innerHTML = html;
        }
    }

    //下一题
    function nextAnswer() {
        if (theAnswer == countlib) {
            showdiv();
        } else if (theAnswer < countlib) {
            var item = theAnswer + 1;
            initAnswer(item);
            Epg.btn.set(initButton);
        }
    }

//弹窗
    function showdiv() {
        G('transparent_bg').style.visibility = "visible";
    	G('pop_div').style.display = "block";
        G('countscore').innerHTML = countscore;
        G('correctnum').innerHTML = correctnum;
        G('wrongnum').innerHTML = wrongnum;
        rednum = parseInt(countscore/10);
        G('rednum').innerHTML = rednum;
        Epg.btn.set('re_answer');
    }
    
//返回弹窗
	function showExit(){
        G('transparent_bg').style.visibility = "visible";
    	G('pop_exit_div').style.display = "block";
        Epg.btn.set('no');
}

//返回弹窗
function disExit(){
        G('transparent_bg').style.visibility = "hidden";
    	G('pop_exit_div').style.display = "none";
        Epg.btn.set('exit');
}

//重新答题
    function reanswer() {
        window.location.reload();
    }

//返回
    function backlearn() {
        var jsonText = JSON.stringify(postdata);
        G('post_data').value = jsonText;
        G('count_score').value = countscore;
        G('red_flower').value = rednum;
        G('postlib').submit();
    }
    window.onload = function()
    {
        initAnswer(1);
        Epg.btn.init(initButton, buttons, true);
    }
    
    Epg.Button.defBack = function(){
    	showExit();
    }
    
    function exitPrePage(){
    	window.location =  "{:get_back_url('Index/recommend',1)}";
    }
</script>

<!-- 同步课堂 -->
<div id="div_top">
       <div id="div_btn_ketang" style="position:absolute;width:137px;height:42px;left:4px;top:3px;">
           <img id="btn_ketang" title="" src="__HD__/images/library/btn_ketang.png" width="137" height="42">
       </div>
</div>

<!-- sectionName -->
<div style="position:absolute;width:440px;height:55px;top:75px;left:430px; font-size: 28px;color: #00648c;text-align:center;">{$sectionName}</div>
<!-- 标题 -->
<div class="title" id="title" style="font-size: 28px;">{$title}</div>

<!-- 答题选项答案 -->
<div id="word" style="display:none"></div>

<div id="pic" style="display:none"></div>

<!-- 页码 -->
<div id="now_page" style="position:absolute;width:135px;height:38px;line-height: 40px;color:#784600; left:960px;top:133px;font-size:28px;font-weight: 500;text-align:center;">
    
</div>

<!-- 下一页-->
<div id="div_next" style="position:absolute;width:136px;height:60px;left:910px;top:585px;text-align:center;">
    <img id="next" src="__HD__/images/library/next.png" width="136" height="60">
</div>

<!-- 返回按钮 -->
<div id="div_exit" style="position:absolute;width:110px;height:60px;left:1090px;top:585px;text-align:center;">
    <img id="exit" src="__HD__/images/library/exit.png" width="110" height="60">
</div>

<div id="transparent_bg"></div>

<!-- 退出提示框 -->
<div id="pop_exit_div" class="pop_exit_div" style="display:none;">
    <!-- 背景 -->
    <div id="pop_exit_bg" class="pop_exit_bg"></div>
    <!-- 弹窗描述 -->
    <div style="position:absolute;width:300px;height:40px;left:380px;top:290px;text-align:center;font-size:30px; color:#784600; z-index: 1000;"><b>确定要退出练习吗？</b></div>
    <!-- 是的 -->
    <div id="div_yes" style="position:absolute;width:116px;height:51px;left:400px;top:370px;text-align:center;z-index: 1000;">
        <img id="yes" src="__HD__/images/library/yes.png" width="116" height="51">
    </div>
    <!-- 不 -->
    <div id="div_no" style="position:absolute;width:116px;height:51px;left:550px;top:370px;text-align:center;z-index: 1000;">
        <img id="no" src="__HD__/images/library/no.png" width="116" height="51">
    </div>
</div>

<div id="pop_div" class="pop_div" style="display:none;">
    <!-- 背景 -->
    <div class="pop_bg"></div>
    <!-- 获取多少分 -->
    <div id="countscore" class="countscore">0</div>
    <!-- 答对多少题 -->
    <div id="correctnum" class="correctnum">0</div>
    <!-- 答错多少题 -->
    <div id="wrongnum" class="wrongnum">0</div>
    <!-- 获取多少小红花 -->
    <div id="rednum" class="rednum">0</div>
    <!-- 重新答题 -->
    <div id="div_re_answer" style="position:absolute;width:146px;height:56px;left:450px;top:400px;text-align:center;z-index: 1000;">
        <img id="re_answer" src="__HD__/images/library/re_answer.png" width="146" height="56">
    </div>
    <!-- 返回学习 -->
    <div id="div_back_learn" style="position:absolute;width:146px;height:56px;left:680px;top:400px;text-align:center;z-index: 1000;">
        <img id="back_learn" src="__HD__/images/library/back_learn.png" width="146" height="56">
    </div>
</div>
<form id="postlib" action="{:U('Library/saveLib')}" method="post">
    <input type="hidden" name="postdata" id="post_data" />
    <input type="hidden" name="topicid" id="topic_id" value="{$topicId}" />
    <input type="hidden" name="sectionid" id="section_id" value="{$sectionId}" />
    <input type="hidden" name="countscore" id="count_score" />
    <input type="hidden" name="redflower" id="red_flower" />
</form>    